<!DOCTYPE html>
<html>
<head>
    <title>MomeJang!</title>
    <!--<link rel="stylesheet" href="css/vendor/jquery-ui-1.12.1.min.css" />-->
    <link rel="stylesheet" href="css/vendor/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" href="css/vendor/bootstrap.3.3.7.min.css" />
    <link rel="stylesheet" href="css/vendor/bootstrap-theme.3.3.7.min.css" />
    <link rel="stylesheet" href="css/findusers.css" />
    <style>
        .input-group-btn button span { color: white; }
    </style>
</head>
<body>
    <div role="page">
        <div role="content" class="ui-content">
            <div data-role="tabs">
                <div data-role="navbar">
                    <ul>
                        <li id="teamtab"><a href="#teamTab" class="ui-btn-active">Team</a></li>
                        <li><a href="#searchTab">Search</a></li>
                        <li><a href="#profileTab">Profile</a></li>
                    </ul>
                </div>
                <div id="teamTab">
                    <div id="usersList">
                        <!--<div class="userWrapper" id="19c7eda1-9174-44bd-8f96-9b2dd10f226b">
                            <div class="userTile"><img src="img/roger.png" /></div>
                            <div class="userData">
                                <div class="userName">Roger Rabbit</div>
                                <div class="userLocation">Las Vegas, NV, USA</div>
                            </div>
                            <div class="userActions">
                                <a href="#" data-role="button" data-mini="true">Add to Team</a>
                            </div>
                        </div>-->
                    </div>
                </div>
                <div id="searchTab">
                    <div id="selectTitle">Work out with...</div>
                    <div id="searchUser" class="row">
                        <div class="col-xs-12">
                            <div class="input-group">
                                <input id="searchUserText" type="text" class="form-control" placeholder="Search by name or id!" />
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button">
                                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div id="searchResultsList">
                        <!--<div class="userWrapper" id="19c7eda1-9174-44bd-8f96-9b2dd10f226b">
                            <div class="userTile"><img src="img/roger.png" /></div>
                            <div class="userData">
                                <div class="userName">Roger Rabbit</div>
                                <div class="userLocation">Las Vegas, NV, USA</div>
                            </div>
                            <div class="userActions">
                                <a href="#" data-role="button" data-mini="true">Add to Team</a>
                            </div>
                        </div>-->
                    </div>
                </div>
                <div id="profileTab">
                    <div class="profileImage"><img src="img/duke.png" /></div>
                    <div class="profileData">
                        <div class="profileName">Duke Nukem</div>
                        <div class="profileLocation">Seoul, South Korea</div>
                    </div>
                </div>
            </div>
        </div>
       <div data-role="footer" data-position="fixed" id="momeFoot">
            <div data-role="navbar">
                <ul>
                    <li><a href="#exerciselist.html" class="ui-btn-active ui-state-persist "><span class="glyphicon glyphicon-th-large"></span><div class="footerText">Exercises</div></a></li>
                    <li><a href="#users.html" class=""><span class="glyphicon glyphicon-user"></span><div class="footerText">Users</div></a></li>
                </ul>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/jquery-3.2.0.min.js"></script>
    <script type="text/javascript" src="js/jquery-migrate-3.0.0.min.js"></script>
    <!--<script src="js/jquery-ui-1.12.1.min.js"></script>-->
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="js/bootstrap.3.3.7.min.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // $('.userWrapper').on('click', function (evt) { console.log("Clicked on User: " + $(this).attr('id')); });

        $(function() { getTeam(); });
        $("#teamtab").click(function() { getTeam(); });

        $('#searchUserText').on('keypress', function (evt) { if (evt.which === 13) { findTeam(); } });
        $('.input-group-btn').click(function(e) { findTeam(); });

        function getTeam() {
            var thisObj = {
                event: "getfriendlist"
                , payload: {
                    userid: 1
                    , offset: 0
                }
            }
            sendWS(thisObj, function(inData) {
                if (inData) {
                    var inObj = JSON.parse(inData);
                   if (inObj.code === 0) {
                        for (var i = 0; i < inObj.results.length; i++) {
                            var thisResults = inObj.results[i];
                            var newHtml = '<div class="userWrapper" id="' + thisResults.UserID + '">'
                                + '<div class="userTile"><img src="img/duke.png" /></div>'
                                + '<div class="userData">'
                                    + '<div class="userName">' + thisResults.Username + '</div>'
                                    + '<div class="userFullname">' + thisResults.FirstName + ' ' + thisResults.LastName + '</div>'
                                + '</div>'
                                + '<div class="userActions">'
                                    + '<a href="#" data-role="button" data-mini="true">Add to Team</a>'
                                + '</div>'
                                + '</div>';
                            $("#usersList").append(newHtml);
                            $("#usersList").enhanceWithin();
                        }
                    } else { alert("PROBLEM: " + inObj.message); }
                }
            });
        }

        function findTeam() {
            var searchTerm = $("#searchUserText").val();
            console.log("Got search term: " + searchTerm);

            var errorMsg = [];
            searchTerm = searchTerm.trim();
            if (searchTerm.length < 3) errorMsg.push("Search term needs to be at least 3 characters!");

            if (errorMsg.length !== 0) {
                alert(errorMsg.join('\n'));
                return;
            }

            var thisObj = {
                event: "searchforuser"
                , payload: {
                    parameter: searchTerm
                    , offset: 0
                }
            };
            sendWS(thisObj, function(inData) {
                if (inData) {
                    var inObj = JSON.parse(inData);
                    $("#searchResultsList").empty();
                    if (inObj.code === 0) {
                        for (var i = 0; i < inObj.results.length; i++) {
                            var thisResults = inObj.results[i];
                            var newHtml = '<div class="userWrapper" id="' + thisResults.UserID + '">'
                                + '<div class="userTile"><img src="img/duke.png" /></div>'
                                + '<div class="userData">'
                                    + '<div class="userName">' + thisResults.Username + '</div>'
                                    + '<div class="userFullname">' + thisResults.FirstName + ' ' + thisResults.LastName + '</div>'
                                + '</div>'
                                + '<div class="userActions">'
                                    + '<a href="#" data-role="button" data-mini="true">Add to Team</a>'
                                + '</div>'
                                + '</div>';
                            $("#searchResultsList").append(newHtml);
                            $("#searchResultsList").enhanceWithin();
                            let friendID = thisResults.UserID;
                            $("#" + inObj[i].UserID).click(function() {
                                var reqObj = {
                                    event: "addfriend"
                                    , payload: {
                                        userid: 1
                                        , frienduserid: friendID 
                                    }
                                }
                                sendWS(reqObj, function(inAddResult) { alert(inAddResult); })
                            });
                        }
                    } else { "PROBLEM: " + alert(inObj.message); }
                }
            });
        }

        //$("#tabs").tabs();
    </script>
</body>
</html>